"use client";
import React, { useRef, useEffect, useMemo } from "react";
import mapboxgl from 'mapbox-gl';

const ServiceAreaMap = () => {
  const mapContainerRef = useRef(null);

  const serviceArea = useMemo(() => ({
    type: "FeatureCollection",
    features: [
      {
        type: "Feature",
        properties: {},
        geometry: {
          type: "Polygon",
          coordinates: [
            [
              [-122.02490471435118, 36.95445471556218],
              [-122.02591781657243, 36.96133586708129],
              [-122.01831954991246, 36.96376436033353],
              [-122.00818852769876, 36.96295487118937],
              [-121.99096578993601, 36.95971682854665],
              [-121.97526270550513, 36.9548595063936],
              [-121.96209237662767, 36.961740621335764],
              [-121.95297445663553, 36.971858778394434],
              [-121.93524516776213, 36.97833369311209],
              [-121.89522763001887, 36.96295487118937],
              [-121.85926250116117, 36.928138697027904],
              [-121.79037155010985, 36.80859028186531],
              [-121.80833691219776, 36.72404572692493],
              [-121.82068688787754, 36.667331613796534],
              [-121.85998226503995, 36.61237809377212],
              [-121.88692766652254, 36.599760280407295],
              [-121.9116276178818, 36.625894888818834],
              [-121.93745029430272, 36.6394093138459],
              [-121.94306391961177, 36.615081642366675],
              [-121.95878207047659, 36.61057567538211],
              [-121.96327297072398, 36.589844836231904],
              [-121.97225477121806, 36.58173125243364],
              [-121.97786839652713, 36.574518462004946],
              [-121.95541389529123, 36.56099266395994],
              [-121.94530936973547, 36.56550152648002],
              [-121.93071394393232, 36.555581681571496],
              [-121.93408211911735, 36.54205256786413],
              [-121.92397759356157, 36.529423258672196],
              [-121.93632756924103, 36.523107830641464],
              [-121.95429117022957, 36.523107830641464],
              [-121.94867754492083, 36.514987237024386],
              [-121.94081846948808, 36.50596335572871],
              [-121.94530936973547, 36.48339905018621],
              [-121.93183666899398, 36.46443995350154],
              [-121.92846849380862, 36.45631320671819],
              [-121.92846849380862, 36.447282489199],
              [-121.91050489282011, 36.424701095987785],
              [-121.91499579306716, 36.415666699206255],
              [-121.90601399257307, 36.39307610940638],
              [-121.90713671763476, 36.3704789525367],
              [-121.5013924036788, 36.37197494852414],
              [-121.5198231417915, 36.85804859098086],
              [-121.55931758060501, 36.9085925853507],
              [-121.68569978480745, 37.00958015966643],
              [-121.79891717607218, 37.08943363027029],
              [-121.80944902642258, 37.185985898471],
              [-121.75678977467138, 37.28660465320105],
              [-121.79101828830949, 37.403823370184696],
              [-121.8621082781734, 37.45818412194191],
              [-121.95689493132542, 37.437280812439],
              [-121.99112344496353, 37.41218913212771],
              [-122.02271899601432, 37.42264502082425],
              [-122.05958047223974, 37.418462840517975],
              [-122.10170787364095, 37.41428042664748],
              [-122.40449857120933, 37.280319916123545],
              [-122.42292930932203, 37.244696493536324],
              [-122.40186560862162, 37.211153176638064],
              [-122.40186560862162, 37.190181027496735],
              [-122.3623711698085, 37.173399113171754],
              [-122.34657339428311, 37.14612055103599],
              [-122.3360415439331, 37.11673263103593],
              [-122.3018130302946, 37.11673263103593],
              [-122.22282415266798, 37.02429632179448],
              [-122.13856934986637, 36.96962192686787],
              [-122.05431454706473, 36.9464786201423],
              [-122.01482010825163, 36.95279112860737],
            ],
          ],
        },
      },
    ],
  }), []);

  useEffect(() => {
    if (!mapContainerRef.current) return;

    mapboxgl.accessToken = "pk.eyJ1IjoiYnlyb253YWRlIiwiYSI6ImNqOG9xdzJ4djA3c3AzM3J6ZWRyemNoczAifQ.YdEsyaOK8qvPGZ8eU43W4g";

    const map = new mapboxgl.Map({
      container: mapContainerRef.current,
      style: "mapbox://styles/byronwade/clnfa4pyb01b701ps8jw09pik",
      center: [-121.955235, 36.974117],
      zoom: 8,
      interactive: false,
      attributionControl: false,
      preserveDrawingBuffer: false,
    });

    map.on("load", () => {
      map.addSource("service-area", {
        type: "geojson",
        data: serviceArea,
      });

      map.addLayer({
        id: "service-area-layer",
        type: "fill",
        source: "service-area",
        paint: {
          "fill-color": "#ff0000",
          "fill-opacity": 0.3,
        },
      });

      map.addLayer({
        id: "outline-layer",
        type: "line",
        source: "service-area",
        paint: {
          "line-color": "#ff0000",
          "line-width": 2,
        },
      });
    });

    return () => map.remove();
  }, [serviceArea]);

  return <div ref={mapContainerRef} className="absolute top-0 right-0 map-container" style={{ height: "100%", width: "113%" }} />;
};

export default ServiceAreaMap;
